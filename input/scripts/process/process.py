from pyspark.sql import SparkSession, dataframe
from pyspark.sql.types import StructType, StructField
from pyspark.sql.types import DoubleType, IntegerType, StringType
from pyspark.sql import HiveContext
from pyspark.sql.functions import *
from pyspark.sql import functions as f
import os
import re

spark = SparkSession.builder.master("local[*]")\
    .enableHiveSupport()\
    .getOrCreate()

# Criando dataframes diretamente do Hive
df_clientes = spark.sql("SELECT * FROM DESAFIO_CURSO.TBL_CLIENTES")

# Espaço para tratar e juntar os campos e a criação do modelo dimensional
+--------------------+------------+----------+---------------+------------+--------------+----------+-----------+--------------------+-----------+----------+------------+----------------------+------------+--------------------------------+-----------------+-------------------+-----------+--------------+---------+---+--------------+---------------+-------------+-------------------+-------------+--------+----------------+------------+-----------+------------------+-----------+---------------+-------------+--------------------+--------------------+------------------+------------------+-------------+----------+-------------+-------------+---+-----+----+
|actual_delivery_date|customer_key|  date_key|discount_amount|invoice_date|invoice_number|item_class|item_number|                item|line_number|list_price|order_number|promised_delivery_date|sales_amount|sales_amount_based_on_list_price|sales_cost_amount|sales_margin_amount|sales_price|sales_quantity|sales_rep|u_m|address_number|business_family|business_unit|           customer|customer_type|division|line_of_business|       phone|region_code|regional_sales_mgr|search_type|           city|      country|  customer_address_1|  customer_address_2|customer_address_3|customer_address_4|        state|  zip_code|division_name|  region_name|Day|Month|Year|
+--------------------+------------+----------+---------------+------------+--------------+----------+-----------+--------------------+-----------+----------+------------+----------------------+------------+--------------------------------+-----------------+-------------------+-----------+--------------+---------+---+--------------+---------------+-------------+-------------------+-------------+--------+----------------+------------+-----------+------------------+-----------+---------------+-------------+--------------------+--------------------+------------------+------------------+-------------+----------+-------------+-------------+---+-----+----+
|          27/10/2019|    10014495|26/10/2018|         915,99|  28/10/2018|        117050|       P01|      17801|Better Fancy Cann...|       1000|   1431,23|      213985|            27/10/2019|      515.24|                         1431,23|                0|             515,24|     515,24|             1|      161| EA|      10014495|             R3|            1|Harvard Supermarket|           G2|       2|   Não informado|816-455-8733|          1|               S16|          C|      Clackamas|           US| 12900 SE Capps Road|       Não informado|     Não informado|     Não informado|           OR|     97015|     Domestic|      Western| 28|   10|2018|
|          18/10/2019|    10016858|18/10/2018|        6112,56|  20/10/2018|        100604|       P01|      33446|Best Choice Low F...|       2000|    974,69|      200644|            18/10/2019|     5583.72|                        11696,28|                0|            5583,72|     465,31|            12|      159| EA|      10016858|             R2|            1|          IBVA Shop|           G2|       2|   Não informado|816-455-8733|          1|                S5|          C|      Beaverton|           US|6590 SW Fallbrook...|(Commercial Indus...|     Não informado|     Não informado|           OR|     97008|     Domestic|      Western| 20|   10|2018|
|          29/12/2018|    10000486|01/01/2018|         282,33|  03/01/2018|        329700|       P01|      38842|        Ebony Lemons|      11000|    192,91|      124076|            29/12/2018|       296.4|                          578,73|           160,72|             135,68|       98,8|             3|      162| EA|      10000486|             R3|            1|      Aberdeen Shop|           G2|       1|   Não informado|816-455-8733|          5|               S14|          C|  Não informado|Não informado|       Não informado|       Não informado|     Não informado|     Não informado|Não informado|         0|International|International| 03|   01|2018|
|          02/01/2019|    10019194|02/01/2018|         319,43|  04/01/2018|        329856|       P01|      28771|       Ebony Oranges|      35000|    157,76|      124056|            02/01/2019|      311.61|                          631,04|           213,35|              98,26|    77,9025|             4|      108| SE|      10019194|             R3|            1|     Kerite Company|           G2|       1|   Não informado|816-455-8733|          5|               S14|          C|  Não informado|Não informado|       Não informado|       Não informado|     Não informado|     Não informado|Não informado|         0|International|International| 04|   01|2018|
|          02/01/2019|    10015253|03/01/2018|         265,45|  05/01/2018|        329966|       P01|      37170|Fast BBQ Potato C...|       8000|    190,85|      124291|            02/01/2019|       307.1|                          572,55|            127,9|              179,2|102,3666667|             3|      158| EA|      10015253|             R3|            1|     Hekimian Store|           G3|       1|   Não informado|816-455-8733|          5|                S8|          C|  Não informado|Não informado|       Não informado|       Não informado|     Não informado|     Não informado|Não informado|         0|International|International| 05|   01|2018|
|          08/01/2019|    10011345|08/01/2018|         423,69|  10/01/2018|        330315|       P01|     465052|  Club String Cheese|       5000|    960,15|      124088|            08/01/2019|      536.46|                          960,15|           300,27|             236,19|     536,46|             1|      131| EA|      10011345|             R3|            1|      Emergent Shop|           G2|       1|   Não informado|816-455-8733|          5|               S16|          C|  Não informado|Não informado|       Não informado|       Não informado|     Não informado|     Não informado|Não informado|         0|International|International| 10|   01|2018|
|          08/01/2019|    10022962|08/01/2018|         823,28|  10/01/2018|        119676|       P01|      26651|Gorilla Mild Ched...|      10000|    352,96|      216645|            08/01/2019|      941.52|                          1764,8|           418,41|             523,11|    188,304|             5|      147| EA|      10022962|             R3|            1|       Reflex Store|           G1|       1|              M1|816-455-8733|          5|               S19|          C|  Não informado|Não informado|       Não informado|       Não informado|     Não informado|     Não informado|Não informado|         0|International|International| 10|   01|2018|
|          08/01/2019|    10027119|08/01/2018|         227,55|  10/01/2018|        330305|         0|      64798|American Roasted ...|       7000|    456,57|      124350|            08/01/2019|      229.02|                          456,57|           130,72|               98,3|     229,02|             1|      155| EA|      10027119|             R3|            1|       Yurie Market|           G2|       1|   Não informado|816-455-8733|          5|               S16|          C|  Não informado|           UK|       Não informado|       Não informado|     Não informado|     Não informado|Não informado|         0|International|International| 10|   01|2018|
|          09/01/2019|    10016548|09/01/2018|     21210,7536|  11/01/2018|        330442|       P01|      26502|Bravo Large Canne...|       4000|  905,8107|      122187|            09/01/2019|    22268.16|                      43478,9136|         12813,33|            9454,83|     463,92|            48|      118| EA|      10016548|             R3|            1|    Home Superstore|           G2|       2|   Não informado|816-455-8733|          2|               S16|          C|         Mobile|           US| 4700 Rangeline Road|       Não informado|     Não informado|     Não informado|           AL|     36619|     Domestic|     Southern| 11|   01|2018|
|          13/01/2019|    10012422|13/01/2018|         651,05|  15/01/2018|        120072|       P01|      45880|Red Spade Low Fat...|      27000|    767,75|      216976|            13/01/2019|      884.45|                          1535,5|           576,32|             308,13|    442,225|             2|      176| EA|      10012422|             R3|            1|     Finishing Shop|           G2|       2|   Não informado|816-455-8733|          2|               S16|          C|        Saginaw|           US|          PO Box 510|       Não informado|     Não informado|     Não informado|           AL|     35137|     Domestic|     Southern| 15|   01|2018|
|          14/01/2019|    10015495|14/01/2018|         238,31|  16/01/2018|        120147|       P01|      39680|Even Better Strin...|      90000|    263,15|      216254|            14/01/2019|      287.99|                           526,3|           203,05|              84,94|    143,995|             2|      125| EA|      10015495|             R3|            1|           Hennings|           G2|       2|              M1|816-455-8733|          4|               S16|          C|    Kansas City|           US|Attention:  Accou...|     686 South Adams|     Não informado|     Não informado|           KS|     66105|     Domestic|      Central| 16|   01|2018|
|          15/01/2019|    10000481|15/01/2018|         389,88|  17/01/2018|        120327|       P01|      33445|Best Choice Corn ...|       1000|    974,69|      217557|            15/01/2019|      584.81|                          974,69|           353,52|             231,29|     584,81|             1|      184| EA|      10000481|             R2|            1|        Abbott Shop|           G2|       2|   Não informado|816-455-8733|          4|                S5|          C|        Chicago|           US|            Box 5516|       Não informado|     Não informado|     Não informado|           IL|     60680|     Domestic|      Central| 17|   01|2018|
|          16/01/2019|    10026868|16/01/2018|         266,77|  18/01/2018|        120356|       P01|      11391|High Top Cauliflower|      19000|     63,54|      216654|            16/01/2019|      305.09|                          571,86|           170,57|             134,52|33,89888889|             9|      131| EA|      10026868|             R3|            1|       Xyratex Shop|           G1|       1|              M1|816-455-8733|          5|               S16|          C|       Valencia|           UK|Aut Reg Del Centr...|A Pto Cabello Dis...|  Centro Comercial|        IL Portico|Não informado|         0|International|International| 18|   01|2018|
|          19/01/2019|    10025022|20/01/2018|         394,29|  22/01/2018|        120634|       P01|      37171|     Fast Corn Chips|      31000|    169,04|      216929|            19/01/2019|      450.91|                           845,2|           320,81|              130,1|     90,182|             5|      170| EA|      10025022|             R3|            1|   Take Supermarket|           G1|       1|              M1|816-455-8733|          5|               S19|          C|  West Midlands|           UK|Bromley St Lye St...|       Não informado|     Não informado|     Não informado|Não informado|   DY9 8HS|International|International| 22|   01|2018|
|          21/01/2019|    10016588|21/01/2018|          647,5|  23/01/2018|        120790|       P01|      28396|   Ebony New Potatos|      39000|      14,3|      217528|            21/01/2019|       782.5|                            1430|              329|              453,5|      7,825|           100|      104| EA|      10016588|             R3|            1|   Bounds Megaplace|           G2|       2|              M1|816-455-8733|          2|               S16|          C|        Schertz|           US|6025 Corridor Par...|       Não informado|     Não informado|     Não informado|           TX|78154-3214|     Domestic|     Southern| 23|   01|2018|
|          23/01/2019|    10015793|23/01/2018|         875,21|  25/01/2018|        121042|       P01|      28401|Ebony Prepared Salad|       9000|    966,44|      217905|            23/01/2019|     1057.67|                         1932,88|           556,76|             500,91|    528,835|             2|      173| EA|      10015793|             R3|            1|Hetrick Supermarket|           G2|       2|   Não informado|816-455-8733|          1|               S16|          C|     Sacramento|           US|3248 Auburn Boule...|       Não informado|     Não informado|     Não informado|           CA|     95821|     Domestic|      Western| 25|   01|2018|
|          22/01/2018|    10025158|22/01/2017|         272,46|  25/01/2017|        319948|       P01|      38845|       Ebony Peaches|      11001|    191,33|      116576|            22/01/2018|      301.53|                          573,99|           164,11|             137,42|     100,51|             3|      125| EA|      10025158|             R3|            1|Taskers Supermarket|           G1|       1|              M1|816-455-8733|          5|               S19|          C|  Não informado|Não informado|       Não informado|       Não informado|     Não informado|     Não informado|Não informado|         0|International|International| 25|   01|2017|
|          23/01/2019|    10025919|23/01/2018|         421,86|  25/01/2018|        121088|       P01|      61856|   Moms Potato Salad|      40000|    232,92|      218048|            23/01/2019|      509.82|                          931,68|              287|             222,82|    127,455|             4|      108| EA|      10025919|             R3|            1|           Vanstars|           G2|       2|              M1|816-455-8733|          1|               S16|          C|        Compton|           US|801 West Artesia ...|       Não informado|     Não informado|     Não informado|           CA|     90220|     Domestic|      Western| 25|   01|2018|
|          26/01/2019|    10000466|27/01/2018|          457,4|  29/01/2018|        121230|       P01|      30279|Even Better Sharp...|       1000|   1078,77|      218179|            26/01/2019|      621.37|                         1078,77|           449,98|             171,39|     621,37|             1|      161| EA|      10000466|             R3|            1|          A2Z Store|           G2|       2|   Não informado|816-455-8733|          1|               S16|          C|North Highlands|           US|3213 Orange Grove...|       Não informado|     Não informado|     Não informado|           CA|     95660|     Domestic|      Western| 29|   01|2018|
|          26/01/2019|    10007134|27/01/2018|        215,538|  29/01/2018|        121216|       P01|      28881|Nationeel Corn Chips|       1000|   48,8438|      218087|            26/01/2019|       272.9|                         488,438|           103,64|             169,26|      27,29|            10|      182| EA|      10007134|             R3|            1|           C&C Shop|           G2|       1|              M1|816-455-8733|          5|                S1|          C|  Não informado|Não informado|       Não informado|       Não informado|     Não informado|     Não informado|Não informado|         0|International|International| 29|   01|2018|
+--------------------+------------+----------+---------------+------------+--------------+----------+-----------+--------------------+-----------+----------+------------+----------------------+------------+--------------------------------+-----------------+-------------------+-----------+--------------+---------+---+--------------+---------------+-------------+-------------------+-------------+--------+----------------+------------+-----------+------------------+-----------+---------------+-------------+--------------------+--------------------+------------------+------------------+-------------+----------+-------------+-------------+---+-----+----+


pk_clientes, (customer_key, address_number, customer)
+--------------------+------------+----------+---------------+------------+--------------+----------+-----------+--------------------+-----------+----------+------------+----------------------+------------+--------------------------------+-----------------+-------------------+-----------+--------------+---------+---+--------------+---------------+-------------+-------------------+-------------+--------+----------------+------------+-----------+------------------+-----------+-------------+-------------+--------------------+--------------------+------------------+------------------+-------------+--------+-------------+-------------+---+-----+----+--------------------+
|actual_delivery_date|customer_key|  date_key|discount_amount|invoice_date|invoice_number|item_class|item_number|                item|line_number|list_price|order_number|promised_delivery_date|sales_amount|sales_amount_based_on_list_price|sales_cost_amount|sales_margin_amount|sales_price|sales_quantity|sales_rep|u_m|address_number|business_family|business_unit|           customer|customer_type|division|line_of_business|       phone|region_code|regional_sales_mgr|search_type|         city|      country|  customer_address_1|  customer_address_2|customer_address_3|customer_address_4|        state|zip_code|division_name|  region_name|Day|Month|Year|          PK_CLIENTE|
+--------------------+------------+----------+---------------+------------+--------------+----------+-----------+--------------------+-----------+----------+------------+----------------------+------------+--------------------------------+-----------------+-------------------+-----------+--------------+---------+---+--------------+---------------+-------------+-------------------+-------------+--------+----------------+------------+-----------+------------------+-----------+-------------+-------------+--------------------+--------------------+------------------+------------------+-------------+--------+-------------+-------------+---+-----+----+--------------------+
|          27/10/2019|    10014495|26/10/2018|         915,99|  28/10/2018|        117050|       P01|      17801|Better Fancy Cann...|       1000|   1431,23|      213985|            27/10/2019|      515.24|                         1431,23|                0|             515,24|     515,24|             1|      161| EA|      10014495|             R3|            1|Harvard Supermarket|           G2|       2|   Não informado|816-455-8733|          1|               S16|          C|    Clackamas|           US| 12900 SE Capps Road|       Não informado|     Não informado|     Não informado|           OR|   97015|     Domestic|      Western| 28|   10|2018|4a50f5934e1573efc...|
|          18/10/2019|    10016858|18/10/2018|        6112,56|  20/10/2018|        100604|       P01|      33446|Best Choice Low F...|       2000|    974,69|      200644|            18/10/2019|     5583.72|                        11696,28|                0|            5583,72|     465,31|            12|      159| EA|      10016858|             R2|            1|          IBVA Shop|           G2|       2|   Não informado|816-455-8733|          1|                S5|          C|    Beaverton|           US|6590 SW Fallbrook...|(Commercial Indus...|     Não informado|     Não informado|           OR|   97008|     Domestic|      Western| 20|   10|2018|5e1352a8e54b9715f...|
|          29/12/2018|    10000486|01/01/2018|         282,33|  03/01/2018|        329700|       P01|      38842|        Ebony Lemons|      11000|    192,91|      124076|            29/12/2018|       296.4|                          578,73|           160,72|             135,68|       98,8|             3|      162| EA|      10000486|             R3|            1|      Aberdeen Shop|           G2|       1|   Não informado|816-455-8733|          5|               S14|          C|Não informado|Não informado|       Não informado|       Não informado|     Não informado|     Não informado|Não informado|       0|International|International| 03|   01|2018|945ef3186eddfb6f2...|
|          02/01/2019|    10019194|02/01/2018|         319,43|  04/01/2018|        329856|       P01|      28771|       Ebony Oranges|      35000|    157,76|      124056|            02/01/2019|      311.61|                          631,04|           213,35|              98,26|    77,9025|             4|      108| SE|      10019194|             R3|            1|     Kerite Company|           G2|       1|   Não informado|816-455-8733|          5|               S14|          C|Não informado|Não informado|       Não informado|       Não informado|     Não informado|     Não informado|Não informado|       0|International|International| 04|   01|2018|5b7f30b6c4136de51...|
|          02/01/2019|    10015253|03/01/2018|         265,45|  05/01/2018|        329966|       P01|      37170|Fast BBQ Potato C...|       8000|    190,85|      124291|            02/01/2019|       307.1|                          572,55|            127,9|              179,2|102,3666667|             3|      158| EA|      10015253|             R3|            1|     Hekimian Store|           G3|       1|   Não informado|816-455-8733|          5|                S8|          C|Não informado|Não informado|       Não informado|       Não informado|     Não informado|     Não informado|Não informado|       0|International|International| 05|   01|2018|3f8158bbf9f6e73a0...|
+--------------------+------------+----------+---------------+------------+--------------+----------+-----------+--------------------+-----------+----------+------------+----------------------+------------+--------------------------------+-----------------+-------------------+-----------+--------------+---------+---+--------------+---------------+-------------+-------------------+-------------+--------+----------------+------------+-----------+------------------+-----------+-------------+-------------+--------------------+--------------------+------------------+------------------+-------------+--------+-------------+-------------+---+-----+----+--------------------+

pk_tempo, (invoice_date, Dia, Mes, Ano)

+--------------------+------------+----------+---------------+------------+--------------+----------+-----------+--------------------+-----------+----------+------------+----------------------+------------+--------------------------------+-----------------+-------------------+-----------+--------------+---------+---+--------------+---------------+-------------+-------------------+-------------+--------+----------------+------------+-----------+------------------+-----------+-------------+-------------+--------------------+--------------------+------------------+------------------+-------------+--------+-------------+-------------+---+-----+----+--------------------+--------------------+
|actual_delivery_date|customer_key|  date_key|discount_amount|invoice_date|invoice_number|item_class|item_number|                item|line_number|list_price|order_number|promised_delivery_date|sales_amount|sales_amount_based_on_list_price|sales_cost_amount|sales_margin_amount|sales_price|sales_quantity|sales_rep|u_m|address_number|business_family|business_unit|           customer|customer_type|division|line_of_business|       phone|region_code|regional_sales_mgr|search_type|         city|      country|  customer_address_1|  customer_address_2|customer_address_3|customer_address_4|        state|zip_code|division_name|  region_name|Day|Month|Year|          PK_CLIENTE|            PK_TEMPO|
+--------------------+------------+----------+---------------+------------+--------------+----------+-----------+--------------------+-----------+----------+------------+----------------------+------------+--------------------------------+-----------------+-------------------+-----------+--------------+---------+---+--------------+---------------+-------------+-------------------+-------------+--------+----------------+------------+-----------+------------------+-----------+-------------+-------------+--------------------+--------------------+------------------+------------------+-------------+--------+-------------+-------------+---+-----+----+--------------------+--------------------+
|          27/10/2019|    10014495|26/10/2018|         915,99|  28/10/2018|        117050|       P01|      17801|Better Fancy Cann...|       1000|   1431,23|      213985|            27/10/2019|      515.24|                         1431,23|                0|             515,24|     515,24|             1|      161| EA|      10014495|             R3|            1|Harvard Supermarket|           G2|       2|   Não informado|816-455-8733|          1|               S16|          C|    Clackamas|           US| 12900 SE Capps Road|       Não informado|     Não informado|     Não informado|           OR|   97015|     Domestic|      Western| 28|   10|2018|4a50f5934e1573efc...|fb26af7075453e02b...|
|          18/10/2019|    10016858|18/10/2018|        6112,56|  20/10/2018|        100604|       P01|      33446|Best Choice Low F...|       2000|    974,69|      200644|            18/10/2019|     5583.72|                        11696,28|                0|            5583,72|     465,31|            12|      159| EA|      10016858|             R2|            1|          IBVA Shop|           G2|       2|   Não informado|816-455-8733|          1|                S5|          C|    Beaverton|           US|6590 SW Fallbrook...|(Commercial Indus...|     Não informado|     Não informado|           OR|   97008|     Domestic|      Western| 20|   10|2018|5e1352a8e54b9715f...|319aa2ce669229bb1...|
|          29/12/2018|    10000486|01/01/2018|         282,33|  03/01/2018|        329700|       P01|      38842|        Ebony Lemons|      11000|    192,91|      124076|            29/12/2018|       296.4|                          578,73|           160,72|             135,68|       98,8|             3|      162| EA|      10000486|             R3|            1|      Aberdeen Shop|           G2|       1|   Não informado|816-455-8733|          5|               S14|          C|Não informado|Não informado|       Não informado|       Não informado|     Não informado|     Não informado|Não informado|       0|International|International| 03|   01|2018|945ef3186eddfb6f2...|fa9fca11500541b4c...|
|          02/01/2019|    10019194|02/01/2018|         319,43|  04/01/2018|        329856|       P01|      28771|       Ebony Oranges|      35000|    157,76|      124056|            02/01/2019|      311.61|                          631,04|           213,35|              98,26|    77,9025|             4|      108| SE|      10019194|             R3|            1|     Kerite Company|           G2|       1|   Não informado|816-455-8733|          5|               S14|          C|Não informado|Não informado|       Não informado|       Não informado|     Não informado|     Não informado|Não informado|       0|International|International| 04|   01|2018|5b7f30b6c4136de51...|9dca3e22df2b8c85b...|
|          02/01/2019|    10015253|03/01/2018|         265,45|  05/01/2018|        329966|       P01|      37170|Fast BBQ Potato C...|       8000|    190,85|      124291|            02/01/2019|       307.1|                          572,55|            127,9|              179,2|102,3666667|             3|      158| EA|      10015253|             R3|            1|     Hekimian Store|           G3|       1|   Não informado|816-455-8733|          5|                S8|          C|Não informado|Não informado|       Não informado|       Não informado|     Não informado|     Não informado|Não informado|       0|International|International| 05|   01|2018|3f8158bbf9f6e73a0...|8f6de1ca57b55f4b9...|
+--------------------+------------+----------+---------------+------------+--------------+----------+-----------+--------------------+-----------+----------+------------+----------------------+------------+--------------------------------+-----------------+-------------------+-----------+--------------+---------+---+--------------+---------------+-------------+-------------------+-------------+--------+----------------+------------+-----------+------------------+-----------+-------------+-------------+--------------------+--------------------+------------------+------------------+-------------+--------+-------------+-------------+---+-----+----+--------------------+--------------------+

pk_localidade, (region_name, region_code, city, country, state, zip_code)

+--------------------+------------+----------+---------------+------------+--------------+----------+-----------+--------------------+-----------+----------+------------+----------------------+------------+--------------------------------+-----------------+-------------------+-----------+--------------+---------+---+--------------+---------------+-------------+-------------------+-------------+--------+----------------+------------+-----------+------------------+-----------+-------------+-------------+--------------------+--------------------+------------------+------------------+-------------+--------+-------------+-------------+---+-----+----+--------------------+--------------------+--------------------+
|actual_delivery_date|customer_key|  date_key|discount_amount|invoice_date|invoice_number|item_class|item_number|                item|line_number|list_price|order_number|promised_delivery_date|sales_amount|sales_amount_based_on_list_price|sales_cost_amount|sales_margin_amount|sales_price|sales_quantity|sales_rep|u_m|address_number|business_family|business_unit|           customer|customer_type|division|line_of_business|       phone|region_code|regional_sales_mgr|search_type|         city|      country|  customer_address_1|  customer_address_2|customer_address_3|customer_address_4|        state|zip_code|division_name|  region_name|Day|Month|Year|          PK_CLIENTE|            PK_TEMPO|       PK_LOCALIDADE|
+--------------------+------------+----------+---------------+------------+--------------+----------+-----------+--------------------+-----------+----------+------------+----------------------+------------+--------------------------------+-----------------+-------------------+-----------+--------------+---------+---+--------------+---------------+-------------+-------------------+-------------+--------+----------------+------------+-----------+------------------+-----------+-------------+-------------+--------------------+--------------------+------------------+------------------+-------------+--------+-------------+-------------+---+-----+----+--------------------+--------------------+--------------------+
|          27/10/2019|    10014495|26/10/2018|         915,99|  28/10/2018|        117050|       P01|      17801|Better Fancy Cann...|       1000|   1431,23|      213985|            27/10/2019|      515.24|                         1431,23|                0|             515,24|     515,24|             1|      161| EA|      10014495|             R3|            1|Harvard Supermarket|           G2|       2|   Não informado|816-455-8733|          1|               S16|          C|    Clackamas|           US| 12900 SE Capps Road|       Não informado|     Não informado|     Não informado|           OR|   97015|     Domestic|      Western| 28|   10|2018|4a50f5934e1573efc...|fb26af7075453e02b...|f8a2dbe685af255ad...|
|          18/10/2019|    10016858|18/10/2018|        6112,56|  20/10/2018|        100604|       P01|      33446|Best Choice Low F...|       2000|    974,69|      200644|            18/10/2019|     5583.72|                        11696,28|                0|            5583,72|     465,31|            12|      159| EA|      10016858|             R2|            1|          IBVA Shop|           G2|       2|   Não informado|816-455-8733|          1|                S5|          C|    Beaverton|           US|6590 SW Fallbrook...|(Commercial Indus...|     Não informado|     Não informado|           OR|   97008|     Domestic|      Western| 20|   10|2018|5e1352a8e54b9715f...|319aa2ce669229bb1...|801a40347ba3651a6...|
|          29/12/2018|    10000486|01/01/2018|         282,33|  03/01/2018|        329700|       P01|      38842|        Ebony Lemons|      11000|    192,91|      124076|            29/12/2018|       296.4|                          578,73|           160,72|             135,68|       98,8|             3|      162| EA|      10000486|             R3|            1|      Aberdeen Shop|           G2|       1|   Não informado|816-455-8733|          5|               S14|          C|Não informado|Não informado|       Não informado|       Não informado|     Não informado|     Não informado|Não informado|       0|International|International| 03|   01|2018|945ef3186eddfb6f2...|fa9fca11500541b4c...|b4bd83bea8c7d7956...|
|          02/01/2019|    10019194|02/01/2018|         319,43|  04/01/2018|        329856|       P01|      28771|       Ebony Oranges|      35000|    157,76|      124056|            02/01/2019|      311.61|                          631,04|           213,35|              98,26|    77,9025|             4|      108| SE|      10019194|             R3|            1|     Kerite Company|           G2|       1|   Não informado|816-455-8733|          5|               S14|          C|Não informado|Não informado|       Não informado|       Não informado|     Não informado|     Não informado|Não informado|       0|International|International| 04|   01|2018|5b7f30b6c4136de51...|9dca3e22df2b8c85b...|b4bd83bea8c7d7956...|
|          02/01/2019|    10015253|03/01/2018|         265,45|  05/01/2018|        329966|       P01|      37170|Fast BBQ Potato C...|       8000|    190,85|      124291|            02/01/2019|       307.1|                          572,55|            127,9|              179,2|102,3666667|             3|      158| EA|      10015253|             R3|            1|     Hekimian Store|           G3|       1|   Não informado|816-455-8733|          5|                S8|          C|Não informado|Não informado|       Não informado|       Não informado|     Não informado|     Não informado|Não informado|       0|International|International| 05|   01|2018|3f8158bbf9f6e73a0...|8f6de1ca57b55f4b9...|b4bd83bea8c7d7956...|
+--------------------+------------+----------+---------------+------------+--------------+----------+-----------+--------------------+-----------+----------+------------+----------------------+------------+--------------------------------+-----------------+-------------------+-----------+--------------+---------+---+--------------+---------------+-------------+-------------------+-------------+--------+----------------+------------+-----------+------------------+-----------+-------------+-------------+--------------------+--------------------+------------------+------------------+-------------+--------+-------------+-------------+---+-----+----+--------------------+--------------------+--------------------+







# criando o fato
FT_VENDAS = []


#criando as dimensões
DIM_CLIENTES = []
DIM_TEMPO = []
DIM_LOCALIDADE = []



# função para salvar os dados
def salvar_df(df, file):
    output = "/input/desafio_hive/gold/" + file
    erase = "hdfs dfs -rm " + output + "/*"
    rename = "hdfs dfs -get /datalake/gold/"+file+"/part-* /input/desafio_hive/gold/"+file+".csv"
    print(rename)
    
    
    df.coalesce(1).write\
        .format("csv")\
        .option("header", True)\
        .option("delimiter", ";")\
        .mode("overwrite")\
        .save("/datalake/gold/"+file+"/")

    os.system(erase)
    os.system(rename)

salvar_df(dim_clientes, 'dimclientes')